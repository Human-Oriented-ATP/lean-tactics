window;import{jsxs as s,jsx as t,Fragment as e}from"react/jsx-runtime";import n from"react";class o{lits;posVars;negVars;constructor(s){this.posVars=new Set,this.negVars=new Set,this.lits=[];for(const t of s)this.push(t)}has(s){return s.pos?this.posVars.has(s.v):this.negVars.has(s.v)}hasNeg(s){return s.pos?this.negVars.has(s.v):this.posVars.has(s.v)}push(s){const t=s.pos?this.posVars:this.negVars;t.has(s.v)||(t.add(s.v),this.lits.push(s))}pop(){const s=this.lits.pop();if(void 0!==s){(s.pos?this.posVars:this.negVars).delete(s.v)}return s}isSubsetOf(s){for(const t of this.posVars)if(!s.posVars.has(t))return!1;for(const t of this.negVars)if(!s.negVars.has(t))return!1;return!0}clone(){return new o(this.lits)}}function i(s,t,e){return new o(s.lits.filter((s=>!(s.pos&&s.v==e))).concat(t.lits.filter((s=>!(!s.pos&&s.v==e)))))}function l(s,t){const e=[];for(const n of s.lits){if(t.has(n))return;t.hasNeg(n)||e.push(n)}return new o(e)}function r(s,t){const e=s.filter((s=>!t.isSubsetOf(s)));for(const s of e)if(s.isSubsetOf(t))return e;return e.push(t),e}function c(s,t){const e={assumps:s,globalClauses:t,clauses:[]},n=new Map,o=new Map;for(const i of t){const t=l(i,s);if(void 0!==t){if(1==t.lits.length){const s=t.lits[0];s.pos?n.set(s.v,i):o.set(s.v,i)}e.clauses=r(e.clauses,t)}}if(1==e.clauses.length)return e;for(const[s,t]of n){const n=o.get(s);if(void 0!==n){e.contr=[t,n,s];break}}return e.clauses.sort(((s,t)=>s.lits.length-t.lits.length)),e}function a(s){return s.pos?s.v:"¬"+s.v}function u(s){if(0==s.clause.lits.length)return t("li",{children:"Contradiction"});const n=[];for(const o of s.clause.lits)n.push(t("a",{className:"pointer",onClick:()=>{s.selectLit(o)},children:a(o)})),n.push(t(e,{children:" ∨ "}));return n.pop(),t("li",{children:n})}function h(s){return t("ul",{children:s.clauses.map((e=>t(u,{clause:e,selectLit:s.selectLit})))})}function p(l){const[u,p]=n.useState(new o([])),[f,d]=n.useState([]);function g(s){s.sort(((s,t)=>s.lits.length-t.lits.length)),d(s)}const[b,v]=n.useState(!1),[m,V]=n.useState(!1),[k,C]=n.useState(!1);n.useMemo((()=>{g(l.startClauses.map((s=>new o(s))))}),[]);const w=c(u,f);for(var S=w,x=0;;x++){if(1e5==x){S=w;break}if(m&&1==S.clauses.length&&0==S.clauses[0].lits.length&&S.assumps.lits.length>0){const s=S.assumps.clone();s.pop(),S=c(s,S.globalClauses)}else if(b&&void 0!==S.contr){const[s,t,e]=S.contr;S=c(S.assumps,r(S.globalClauses,i(s,t,e)))}else{if(!(k&&S.clauses.length>0&&1==S.clauses[0].lits.length))break;{const s=S.assumps.clone();for(const t of S.clauses)1==t.lits.length&&s.push(t.lits[0]);S=c(s,S.globalClauses)}}}function L(s){const t=u.clone();t.push(s),p(t)}S!==w&&(p(S.assumps),g(S.globalClauses));const y=[];return y.push(s("form",{children:[t("p",{children:"Automation:"}),s("label",{children:[t("input",{type:"checkbox",onChange:s=>{v(s.target.checked)}}),t("span",{children:" Resolution"})]}),t("br",{}),s("label",{children:[t("input",{type:"checkbox",onChange:s=>V(s.target.checked)}),t("span",{children:" Backtracking"})]}),t("br",{}),s("label",{children:[t("input",{type:"checkbox",onChange:s=>C(s.target.checked)}),t("span",{children:" Unit Propagation"})]}),t("br",{}),t("hr",{})]})),void 0!==w.contr&&y.push(t("button",{onClick:function(){if(void 0===w.contr)return;const[s,t,e]=w.contr;g(r(f,i(s,t,e)))},children:"Derive contradiction"})),u.lits.length>0&&(y.push(t(e,{children:s("p",{children:["Assumed: ",u.lits.map(a).join(", ")," ",t("button",{onClick:function(){if(0==u.lits.length)return;const s=u.clone();s.pop(),p(s)},children:"<"})]})})),w.clauses.length>0?y.push(s(e,{children:[t("p",{children:"Clauses:"}),t(h,{clauses:w.clauses,selectLit:L})]})):y.push(t("p",{children:"All clauses are satisfied!"}))),y.push(s(e,{children:[t("p",{children:"Global clauses:"}),t(h,{clauses:f,selectLit:L})]})),t("div",{children:y})}export{p as default};