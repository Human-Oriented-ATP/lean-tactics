window;import{jsxs as e,jsx as n,Fragment as t}from"react/jsx-runtime";import*as r from"react";import{RpcContext as o,useAsyncPersistent as i,mapRpcError as u,importWidgetModule as s,EditorContext as c,InteractiveMessageData as a}from"@leanprover/infoview";var l=function(){return l=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},l.apply(this,arguments)};function f(e,n,t,r){return new(t||(t=Promise))((function(o,i){function u(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(u,s)}c((r=r.apply(e,n||[])).next())}))}function p(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(u=0)),u;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return u.label++,{value:s[1],done:!1};case 5:u.label++,r=s[1],s=[0];continue;case 7:s=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){u=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){u.label=s[1];break}if(6===s[0]&&u.label<o[1]){u.label=o[1],o=s;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(s);break}o[2]&&u.ops.pop(),u.trys.pop();continue}s=n.call(e,u)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function h(o,i,u){return f(this,void 0,void 0,(function(){var c,a,m,d,v,w,b,y,g,x,E,q,k,C,S,j,N,O=this;return p(this,(function(P){switch(P.label){case 0:return"text"in u?[2,n(t,{children:u.text})]:[3,1];case 1:if(!("element"in u))return[3,3];for(c=u.element,a=c[0],m=c[1],C=c[2],d={},v=0,w=m;v<w.length;v++)b=w[v],y=b[0],g=b[1],d[y]=g;return[4,Promise.all(C.map((function(e){return f(O,void 0,void 0,(function(){return p(this,(function(n){switch(n.label){case 0:return[4,h(o,i,e)];case 1:return[2,n.sent()]}}))}))})))];case 2:return S=P.sent(),"hr"===a?[2,n("hr",{})]:0===S.length?[2,r.createElement(a,d)]:[2,r.createElement(a,d,S)];case 3:return"component"in u?(x=u.component,E=x[0],q=x[1],k=x[2],C=x[3],[4,Promise.all(C.map((function(e){return f(O,void 0,void 0,(function(){return p(this,(function(n){switch(n.label){case 0:return[4,h(o,i,e)];case 1:return[2,n.sent()]}}))}))})))]):[3,6];case 4:return S=P.sent(),j=l(l({},k),{pos:i}),[4,s(o,i,E)];case 5:if(N=P.sent(),!(q in N))throw new Error("Module '".concat(E,"' does not export '").concat(q,"'"));return 0===S.length?[2,r.createElement(N[q],j)]:[2,r.createElement(N[q],j,S)];case 6:return[2,e("span",l({className:"red"},{children:["Unknown HTML variant: ",JSON.stringify(u)]}))];case 7:return[2]}}))}))}function m(s){var c=s.pos,a=s.html,f=r.useContext(o),p=i((function(){return h(f,c,a)}),[f,c,a]);return"resolved"===p.state?p.value:"rejected"===p.state?e("span",l({className:"red"},{children:["Error rendering HTML: ",u(p.error).message]})):n(t,{})}function d(e){return n("div",{children:n("p",{children:"No questions..."})})}function v(e){var t=r.useRef(null);return r.useEffect((function(){null!==t.current&&t.current.reset()}),[e.q.elems]),n("form",l({onSubmit:function(n){n.preventDefault();var t=new FormData(n.currentTarget);e.answer(Object.fromEntries(t))},ref:t},{children:e.q.elems.map((function(t){return n(m,{pos:e.pos,html:t})}))}))}function w(e,n){if(!("element"in e))return e;var t=e.element,r=t[0],o=t[1],i=t[2];if("button"==r||"a"==r){var u=o.slice();return"a"==r&&u.push(["className","pointer dim"]),u.push(["onClick",n]),{element:[r,u,i]}}return{element:[r,o,i.map((function(e){return w(e,n)}))]}}function b(e){return n(m,{html:w(e.html,e.onClick),pos:e.pos})}function y(t){var o=r.useRef(null);return e("div",{children:[n(m,{pos:t.pos,html:t.q.question}),n("div",l({ref:o},{children:t.q.options.map((function(e,r){return n(b,{html:e,pos:t.pos,onClick:function(){return t.answer(r)}})}))}))]})}function g(e){return n(m,{pos:e.pos,html:e.q.code})}"function"==typeof SuppressedError&&SuppressedError;var x={kind:"empty"};function E(e){var t=r.useState([x,null]),i=t[0],u=t[1],s=i[0],l=i[1],h=r.useContext(o),m=r.useContext(c);function w(e){return f(this,void 0,void 0,(function(){var n,t,r;return p(this,(function(o){switch(o.label){case 0:return[4,h.call("processUserAnswer",[e,l])];case 1:return n=o.sent(),t=n[0],r=n[1],u([t,r]),[2]}}))}))}switch(r.useEffect((function(){!function(){f(this,void 0,void 0,(function(){var n,t,r;return p(this,(function(o){switch(o.label){case 0:return[4,h.call("initializeInteraction",e.code)];case 1:return n=o.sent(),t=n[0],r=n[1],u([t,r]),[2]}}))}))}()}),[e.pos.line]),s.kind){case"empty":return n(d,{q:{},answer:w,pos:e.pos});case"form":return n(v,{q:s,answer:w,pos:e.pos});case"select":return n(y,{q:s,answer:w,pos:e.pos});case"custom":return n(g,{q:s,answer:w,pos:e.pos});case"editDocument":return function(e){f(this,void 0,void 0,(function(){return p(this,(function(n){switch(n.label){case 0:return[4,m.api.applyEdit({documentChanges:[e]})];case 1:return n.sent(),w(null),[2]}}))}))}(s.edit),n("div",{});case"error":return n(a,{msg:s.data})}}export{E as default};