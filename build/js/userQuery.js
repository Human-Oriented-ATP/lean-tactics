window;import{jsxs as e,jsx as n,Fragment as t}from"react/jsx-runtime";import*as r from"react";import{RpcContext as o,useAsyncPersistent as i,mapRpcError as u,importWidgetModule as c,InteractiveMessageData as s}from"@leanprover/infoview";var a=function(){return a=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},a.apply(this,arguments)};function l(e,n,t,r){return new(t||(t=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(u,c)}s((r=r.apply(e,n||[])).next())}))}function f(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){u=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){u.label=c[1];break}if(6===c[0]&&u.label<o[1]){u.label=o[1],o=c;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(c);break}o[2]&&u.ops.pop(),u.trys.pop();continue}c=n.call(e,u)}catch(e){c=[6,e],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}function p(o,i,u){return l(this,void 0,void 0,(function(){var s,h,m,d,v,w,b,y,g,x,E,k,q,S,j,C,N,O=this;return f(this,(function(P){switch(P.label){case 0:return"text"in u?[2,n(t,{children:u.text})]:[3,1];case 1:if(!("element"in u))return[3,3];for(s=u.element,h=s[0],m=s[1],S=s[2],d={},v=0,w=m;v<w.length;v++)b=w[v],y=b[0],g=b[1],d[y]=g;return[4,Promise.all(S.map((function(e){return l(O,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,p(o,i,e)];case 1:return[2,n.sent()]}}))}))})))];case 2:return j=P.sent(),"hr"===h?[2,n("hr",{})]:0===j.length?[2,r.createElement(h,d)]:[2,r.createElement(h,d,j)];case 3:return"component"in u?(x=u.component,E=x[0],k=x[1],q=x[2],S=x[3],[4,Promise.all(S.map((function(e){return l(O,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,p(o,i,e)];case 1:return[2,n.sent()]}}))}))})))]):[3,6];case 4:return j=P.sent(),C=a(a({},q),{pos:i}),[4,c(o,i,E)];case 5:if(N=P.sent(),!(k in N))throw new Error("Module '".concat(E,"' does not export '").concat(k,"'"));return 0===j.length?[2,r.createElement(N[k],C)]:[2,r.createElement(N[k],C,j)];case 6:return[2,e("span",a({className:"red"},{children:["Unknown HTML variant: ",JSON.stringify(u)]}))];case 7:return[2]}}))}))}function h(c){var s=c.pos,l=c.html,f=r.useContext(o),h=i((function(){return p(f,s,l)}),[f,s,l]);return"resolved"===h.state?h.value:"rejected"===h.state?e("span",a({className:"red"},{children:["Error rendering HTML: ",u(h.error).message]})):n(t,{})}function m(e){return n("div",{children:n("p",{children:"No questions..."})})}function d(e){var t=r.useRef(null);return r.useEffect((function(){null!==t.current&&t.current.reset()}),[e.q.elems]),n("form",a({onSubmit:function(n){n.preventDefault();var t=new FormData(n.currentTarget);e.answer(Object.fromEntries(t))},ref:t},{children:e.q.elems.map((function(t){return n(h,{pos:e.pos,html:t})}))}))}function v(e,n){if(!("element"in e))return e;var t=e.element,r=t[0],o=t[1],i=t[2];if("button"==r||"a"==r){var u=o.slice();return"a"==r&&u.push(["className","pointer dim"]),u.push(["onClick",n]),{element:[r,u,i]}}return{element:[r,o,i.map((function(e){return v(e,n)}))]}}function w(e){return n(h,{html:v(e.html,e.onClick),pos:e.pos})}function b(t){var o=r.useRef(null);return e("div",{children:[n(h,{pos:t.pos,html:t.q.question}),n("div",a({ref:o},{children:t.q.options.map((function(e,r){return n(w,{html:e,pos:t.pos,onClick:function(){return t.answer(r)}})}))}))]})}"function"==typeof SuppressedError&&SuppressedError;var y={kind:"empty"};function g(e){var t=r.useState(y),i=t[0],u=t[1],c=r.useContext(o);function a(e){return l(this,void 0,void 0,(function(){var n;return f(this,(function(t){switch(t.label){case 0:return[4,c.call("processUserAnswer",e)];case 1:return n=t.sent(),u(n),[2]}}))}))}switch(r.useEffect((function(){!function(){l(this,void 0,void 0,(function(){var n;return f(this,(function(t){switch(t.label){case 0:return[4,c.call("initializeInteraction",e)];case 1:return n=t.sent(),u(n),[2]}}))}))}()}),[e.code]),i.kind){case"empty":return n(m,{q:{},answer:a,pos:e.pos});case"form":return n(d,{q:i,answer:a,pos:e.pos});case"select":return n(b,{q:i,answer:a,pos:e.pos});case"error":return n(s,{msg:i.data})}}export{g as default};