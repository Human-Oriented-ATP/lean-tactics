window;import{jsx as e,Fragment as n,jsxs as t}from"react/jsx-runtime";import*as r from"react";import{RpcContext as o,GoalsLocation as i,useAsyncPersistent as c,mapRpcError as a,LocationsContext as u,importWidgetModule as l}from"@leanprover/infoview";var s=function(){return s=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},s.apply(this,arguments)};function f(e,n,t,r){return new(t||(t=Promise))((function(o,i){function c(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,a)}u((r=r.apply(e,n||[])).next())}))}function p(e,n){var t,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(c=0)),c;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=n.call(e,c)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function h(e,n,t){return f(this,void 0,void 0,(function(){var o,i,c,a,u,d,v,m,y,g,b,w,x,E,S,P,j,k=this;return p(this,(function(T){switch(T.label){case 0:return"text"in t?[2,r.createElement(r.Fragment,null,t.text)]:[3,1];case 1:if(!("element"in t))return[3,3];for(o=t.element,i=o[0],c=o[1],E=o[2],a={},u=0,d=c;u<d.length;u++)v=d[u],m=v[0],y=v[1],a[m]=y;return[4,Promise.all(E.map((function(t){return f(k,void 0,void 0,(function(){return p(this,(function(r){switch(r.label){case 0:return[4,h(e,n,t)];case 1:return[2,r.sent()]}}))}))})))];case 2:return S=T.sent(),"hr"===i?[2,r.createElement("hr")]:0===S.length?[2,r.createElement(i,a)]:[2,r.createElement(i,a,S)];case 3:return"component"in t?(g=t.component,b=g[0],w=g[1],x=g[2],E=g[3],[4,Promise.all(E.map((function(t){return f(k,void 0,void 0,(function(){return p(this,(function(r){switch(r.label){case 0:return[4,h(e,n,t)];case 1:return[2,r.sent()]}}))}))})))]):[3,6];case 4:return S=T.sent(),P=s(s({},x),{pos:n}),[4,l(e,n,b)];case 5:if(j=T.sent(),!(w in j))throw new Error("Module '".concat(b,"' does not export '").concat(w,"'"));return 0===S.length?[2,r.createElement(j[w],P)]:[2,r.createElement(j[w],P,S)];case 6:return[2,r.createElement("span",{className:"red",children:["Unknown HTML variant: ",JSON.stringify(t)]})];case 7:return[2]}}))}))}function d(e){return"hypType"in e.loc?e.loc.hypType[1]:"hypValue"in e.loc?e.loc.hypValue[1]:"target"in e.loc?e.loc.target:void 0}"function"==typeof SuppressedError&&SuppressedError;var v=r.memo((function(l){console.log(l);var v=r.useContext(o),m=l.pos,y=r.useState([]),g=y[0],b=y[1];r.useEffect((function(){return b([])}),[m.uri,m.line,m.character]);var w=r.useMemo((function(){return{isSelected:function(e){return g.some((function(n){return i.isEqual(n,e)}))},setSelected:function(e,n){return b((function(t){var r=t.filter((function(n){return!i.isEqual(n,e)})),o=r.length!==t.length,c="function"==typeof n?n(o):n;return c&&r.push(e),o===c?t:r}))},subexprTemplate:{mvarId:"",loc:{target:"/"}}}}),[g]),x=c((function(){return f(void 0,void 0,void 0,(function(){var e,n;return p(this,(function(t){switch(t.label){case 0:return e={pos:l.pos,expr:l.expr,locations:g.map(d).filter((function(e){return!!e}))},[4,v.call("GoalRendering.rpc",e)];case 1:return n=t.sent(),[2,h(v,m,n)]}}))}))}),[v,g]),E="rejected"===x.state?e("p",s({color:"red"},{children:a(x.error).message})):"loading"===x.state?e(n,{children:"Loading..."}):x.value,S=c((function(){return f(void 0,void 0,void 0,(function(){var e,n;return p(this,(function(t){switch(t.label){case 0:return e={pos:l.pos,expr:l.expr,locations:g.map(d).filter((function(e){return!!e}))},[4,v.call("Panel.rpc",e)];case 1:return n=t.sent(),[2,h(v,m,n)]}}))}))}),[v,g]),P="rejected"===S.state?e("p",s({color:"red"},{children:a(S.error).message})):"loading"===S.state?e(n,{children:"Loading ..."}):S.value;return t("div",{children:[e(u.Provider,s({value:w},{children:E})),e("hr",{}),P]})}));export{v as default};