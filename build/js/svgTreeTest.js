window;import{jsx as e,Fragment as n}from"react/jsx-runtime";import*as t from"react";import{RpcContext as r,GoalsLocation as o,useAsyncPersistent as i,mapRpcError as c,LocationsContext as a,importWidgetModule as u}from"@leanprover/infoview";var l=function(){return l=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},l.apply(this,arguments)};function s(e,n,t,r){return new(t||(t=Promise))((function(o,i){function c(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,a)}u((r=r.apply(e,n||[])).next())}))}function f(e,n){var t,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(c=0)),c;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=n.call(e,c)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function p(e,n,r){return s(this,void 0,void 0,(function(){var o,i,c,a,h,d,m,v,y,b,w,g,E,x,S,T,k,P=this;return f(this,(function(j){switch(j.label){case 0:return"text"in r?[2,t.createElement(t.Fragment,null,r.text)]:[3,1];case 1:if(!("element"in r))return[3,3];for(o=r.element,i=o[0],c=o[1],x=o[2],a={},h=0,d=c;h<d.length;h++)m=d[h],v=m[0],y=m[1],a[v]=y;return[4,Promise.all(x.map((function(t){return s(P,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,p(e,n,t)];case 1:return[2,r.sent()]}}))}))})))];case 2:return S=j.sent(),"hr"===i?[2,t.createElement("hr")]:0===S.length?[2,t.createElement(i,a)]:[2,t.createElement(i,a,S)];case 3:return"component"in r?(b=r.component,w=b[0],g=b[1],E=b[2],x=b[3],[4,Promise.all(x.map((function(t){return s(P,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,p(e,n,t)];case 1:return[2,r.sent()]}}))}))})))]):[3,6];case 4:return S=j.sent(),T=l(l({},E),{pos:n}),[4,u(e,n,w)];case 5:if(k=j.sent(),!(g in k))throw new Error("Module '".concat(w,"' does not export '").concat(g,"'"));return 0===S.length?[2,t.createElement(k[g],T)]:[2,t.createElement(k[g],T,S)];case 6:return[2,t.createElement("span",{className:"red",children:["Unknown HTML variant: ",JSON.stringify(r)]})];case 7:return[2]}}))}))}function h(e){return"hypType"in e.loc?e.loc.hypType[1]:"hypValue"in e.loc?e.loc.hypValue[1]:"target"in e.loc?e.loc.target:void 0}"function"==typeof SuppressedError&&SuppressedError;var d=t.memo((function(u){console.log(u);var d=t.useContext(r),m=u.pos,v=t.useState(u.locations.map((function(e){return{mvarId:"",loc:{target:e}}}))),y=v[0],b=v[1];t.useEffect((function(){return b([])}),[m.uri,m.line,m.character]);var w=t.useMemo((function(){return{isSelected:function(e){return y.some((function(n){return o.isEqual(n,e)}))},setSelected:function(e,n){return b((function(t){var r=t.filter((function(n){return!o.isEqual(n,e)})),i=r.length!==t.length,c="function"==typeof n?n(i):n;return c&&r.push(e),i===c?t:r}))},subexprTemplate:{mvarId:"",loc:{target:"/"}}}}),[y]),g=i((function(){return s(void 0,void 0,void 0,(function(){var e,n;return f(this,(function(t){switch(t.label){case 0:return e=l(l({},u),{locations:y.map(h).filter((function(e){return!!e}))}),[4,d.call("renderTree",e)];case 1:return n=t.sent(),[2,p(d,m,n)]}}))}))}),[d,y]),E="rejected"===g.state?e("p",l({color:"red"},{children:c(g.error).message})):"loading"===g.state?e(n,{children:"Loading..."}):g.value;return e("div",{children:e(a.Provider,l({value:w},{children:E}))})}));export{d as default};